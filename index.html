<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å°å‰ç™¼å¤§è²¡ V10</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Zen+Maru+Gothic:wght@700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ios: { bg: '#F2F2F7', card: '#FFFFFF', blue: '#007AFF', green: '#34C759', red: '#FF3B30', purple: '#5856D6', orange: '#FF9500' },
                        morandi: { main: '#778DA9', pink: '#F4ACB7', light: '#E0E1DD', accent: '#415A77', gold: '#D4AF37' }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Noto Sans TC"', 'sans-serif'],
                        rounded: ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    boxShadow: { 'ios': '0 2px 10px rgba(0,0,0,0.05)' }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F2F2F7; -webkit-tap-highlight-color: transparent; padding-bottom: env(safe-area-inset-bottom); }
        .ios-card { background: white; border-radius: 12px; overflow: hidden; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .ios-header { padding: 12px 16px; border-bottom: 1px solid #F2F2F7; }
        .ios-header-title { font-size: 13px; font-weight: 700; color: #8E8E93; text-transform: uppercase; letter-spacing: 0.5px; }
        .input-label { font-size: 12px; color: #8E8E93; font-weight: 600; margin-left: 4px; margin-bottom: 4px; }
        .input-field { background: #F2F2F7; border-radius: 8px; padding: 12px; font-size: 16px; outline: none; width: 100%; border: 1px solid transparent; transition: all 0.2s; appearance: none; }
        .input-field:focus { background: white; border-color: #E5E5EA; box-shadow: 0 0 0 2px rgba(0,122,255,0.1); }
        
        .tag-btn { padding: 8px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; transition: all 0.2s; border: 1px solid transparent; display: flex; align-items: center; gap: 4px; }
        .tag-btn-active { background-color: #778DA9; color: white; border-color: #778DA9; }
        .tag-btn-inactive { background-color: #F2F2F7; color: #64748B; border-color: #E5E5EA; }

        .segment-control { background-color: #E5E5EA; padding: 2px; border-radius: 9px; display: flex; margin-bottom: 16px; }
        .segment-btn { flex: 1; padding: 6px; text-align: center; border-radius: 7px; font-size: 13px; font-weight: 600; transition: all 0.2s; }
        .active-tab { background-color: white; color: black; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .inactive-tab { color: #636366; }
        
        /* Progress Bar Animation */
        @keyframes fillBar { from { width: 0%; } }
        .progress-fill { animation: fillBar 1s ease-out forwards; }
    </style>
</head>
<body class="pb-24">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const getLocalISODate = () => {
            const now = new Date();
            const offset = now.getTimezoneOffset() * 60000;
            return new Date(now - offset).toISOString().slice(0, 10);
        };
        const fmt = (num) => new Intl.NumberFormat('zh-TW').format(num);
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) { return initialValue; }
            });
            const setValue = (value) => {
                const valueToStore = value instanceof Function ? value(storedValue) : value;
                setStoredValue(valueToStore);
                window.localStorage.setItem(key, JSON.stringify(valueToStore));
            };
            return [storedValue, setValue];
        };

        const DEFAULTS = {
            rent: { label: 'æˆ¿ç§Ÿ', amount: 9974, icon: 'fa-house' },
            mgmt: { label: 'ç®¡ç†è²»', amount: 1410, icon: 'fa-building' },
            car: { label: 'è»Šè²¸', amount: 20000, icon: 'fa-car' },
            scooter: { label: 'æ©Ÿè»Šè²¸', amount: 7000, icon: 'fa-motorcycle' },
            baby: { label: '77å¯¶è²', amount: 30000, icon: 'fa-heart' },
            credit: { label: 'ä¿¡ç”¨å¡', amount: 0, icon: 'fa-credit-card' },
            other: { label: 'å…¶ä»–', amount: '', icon: 'fa-basket-shopping' }
        };

        const ExpenseForm = ({ onAdd }) => {
            const [type, setType] = useState('other');
            const [vals, setVals] = useState({ date: getLocalISODate(), name: '', amount: '' });
            const handleTypeSelect = (key) => {
                setType(key);
                setVals(prev => ({
                    ...prev,
                    name: key === 'other' ? '' : DEFAULTS[key].label,
                    amount: DEFAULTS[key].amount
                }));
            };
            const handleSubmit = () => {
                if (!vals.name || !vals.amount) return;
                onAdd({ ...vals, category: type });
                setVals({ date: vals.date, name: '', amount: '' });
                setType('other');
            };
            return (
                <div className="ios-card">
                    <div className="ios-header"><span className="ios-header-title">æ–°å¢æ”¯å‡ºç´€éŒ„</span></div>
                    <div className="p-4 space-y-4">
                        <div className="flex flex-wrap gap-2">
                            {Object.entries(DEFAULTS).map(([key, cfg]) => (
                                <button key={key} onClick={() => handleTypeSelect(key)} className={`tag-btn ${type === key ? 'tag-btn-active' : 'tag-btn-inactive'}`}>
                                    <i className={`fa-solid ${cfg.icon}`}></i> {cfg.label}
                                </button>
                            ))}
                        </div>
                        <div>
                            <div className="input-label">æ—¥æœŸ</div>
                            <input type="date" value={vals.date} onChange={e => setVals({...vals, date: e.target.value})} className="input-field" />
                        </div>
                        <div className="flex gap-3">
                            <div className="flex-[1.5]">
                                <div className="input-label">é …ç›®åç¨±</div>
                                <input type="text" value={vals.name} onChange={e => setVals({...vals, name: e.target.value})} className="input-field" placeholder="é …ç›®" />
                            </div>
                            <div className="flex-1">
                                <div className="input-label">é‡‘é¡</div>
                                <input type="number" value={vals.amount} onChange={e => setVals({...vals, amount: e.target.value})} className="input-field font-bold text-red-500" placeholder="$" />
                            </div>
                        </div>
                        <button onClick={handleSubmit} className="w-full py-3.5 rounded-lg text-white font-bold text-sm bg-morandi-main shadow-sm active:opacity-90">
                            <i className="fa-solid fa-plus mr-1"></i> åŠ å…¥æ”¯å‡º
                        </button>
                    </div>
                </div>
            );
        };

        const WorkHoursForm = ({ onAdd }) => {
            const [vals, setVals] = useState({ date: getLocalISODate(), note: '', days: '', amount: '' });
            const handleDaysChange = (val) => {
                const days = val;
                setVals(prev => ({ ...prev, days: days, amount: days ? days * 3000 : '' }));
            };
            const handleSubmit = () => {
                if (!vals.days) return;
                onAdd(vals);
                setVals({ date: vals.date, note: '', days: '', amount: '' });
            };
            return (
                <div className="ios-card">
                    <div className="ios-header"><span className="ios-header-title">æ–°å¢å·¥æ™‚ (æˆ‘åšçš„)</span></div>
                    <div className="p-4 space-y-4">
                        <div className="flex gap-3">
                            <div className="flex-1">
                                <div className="input-label">æ—¥æœŸ</div>
                                <input type="date" value={vals.date} onChange={e => setVals({...vals, date: e.target.value})} className="input-field" />
                            </div>
                            <div className="flex-1">
                                <div className="input-label">å·¥åœ°/å‚™è¨»</div>
                                <input type="text" value={vals.note} onChange={e => setVals({...vals, note: e.target.value})} className="input-field" placeholder="å‚™è¨»" />
                            </div>
                        </div>
                        <div className="flex gap-3">
                            <div className="flex-1">
                                <div className="input-label">åšå¹¾å·¥ ($3000/å·¥)</div>
                                <input type="number" value={vals.days} onChange={e => handleDaysChange(e.target.value)} className="input-field text-center font-bold text-purple-600" placeholder="0.5 / 1" step="0.5" />
                            </div>
                            <div className="flex-1">
                                <div className="input-label">é è¨ˆæ”¶å…¥</div>
                                <input type="number" value={vals.amount} readOnly className="input-field font-bold bg-gray-50 text-gray-500" />
                            </div>
                        </div>
                        <button onClick={handleSubmit} className="w-full py-3.5 rounded-lg text-white font-bold text-sm bg-ios-purple shadow-sm active:opacity-90">
                            <i className="fa-solid fa-person-digging mr-1"></i> ç´€éŒ„åšå·¥
                        </button>
                    </div>
                </div>
            );
        };

        const WorkWithdrawForm = ({ onAdd }) => {
            const [vals, setVals] = useState({ date: getLocalISODate(), note: '', days: '', amount: '' });
            const handleDaysChange = (val) => {
                const days = val;
                setVals(prev => ({ ...prev, days: days, amount: days ? days * 3000 : '' }));
            };
            const handleSubmit = () => {
                if (!vals.amount) return;
                onAdd(vals);
                setVals({ date: vals.date, note: '', days: '', amount: '' });
            };
            return (
                <div className="ios-card border-l-4 border-ios-green">
                    <div className="ios-header"><span className="ios-header-title text-ios-green">ç´€éŒ„å·²é ˜ (æˆ‘é ˜çš„)</span></div>
                    <div className="p-4 space-y-4">
                        <div className="flex gap-3">
                            <div className="flex-1">
                                <div className="input-label">æ—¥æœŸ</div>
                                <input type="date" value={vals.date} onChange={e => setVals({...vals, date: e.target.value})} className="input-field" />
                            </div>
                            <div className="flex-1">
                                <div className="input-label">å‚™è¨»</div>
                                <input type="text" value={vals.note} onChange={e => setVals({...vals, note: e.target.value})} className="input-field" placeholder="å¦‚: 7/5é ˜éŒ¢" />
                            </div>
                        </div>
                        <div className="flex gap-3">
                            <div className="flex-1">
                                <div className="input-label">é ˜å¹¾å·¥</div>
                                <input type="number" value={vals.days} onChange={e => handleDaysChange(e.target.value)} className="input-field text-center font-bold text-green-600" placeholder="å·¥æ•¸" />
                            </div>
                            <div className="flex-1">
                                <div className="input-label">å¯¦éš›é‡‘é¡</div>
                                <input type="number" value={vals.amount} onChange={e => setVals({...vals, amount: e.target.value})} className="input-field font-bold text-black" />
                            </div>
                        </div>
                        <button onClick={handleSubmit} className="w-full py-3.5 rounded-lg text-white font-bold text-sm bg-ios-green shadow-sm active:opacity-90">
                            <i className="fa-solid fa-money-bill-wave mr-1"></i> ç´€éŒ„å·²é ˜
                        </button>
                    </div>
                </div>
            );
        };

        const ListItem = ({ item, onDelete, type }) => {
            const day = item.date.split('-')[2];
            let colorClass = 'bg-morandi-main';
            let amountClass = 'text-gray-800';
            let prefix = '';
            let label = item.name || item.note;

            if (type === 'income') { colorClass = 'bg-ios-green'; amountClass = 'text-ios-green'; prefix = '+'; }
            else if (type === 'expense') { colorClass = 'bg-morandi-pink'; amountClass = 'text-gray-800'; prefix = '-'; }
            else if (type === 'work_log') { colorClass = 'bg-ios-purple'; amountClass = 'text-ios-purple'; prefix = '+'; label = `åšå·¥: ${label || ''}` }
            else if (type === 'work_withdraw') { colorClass = 'bg-ios-green'; amountClass = 'text-green-600'; prefix = 'é ˜'; label = `å·²é ˜: ${label || ''}` }
            else if (type === 'dad') { colorClass = 'bg-ios-blue'; amountClass = 'text-ios-blue'; prefix = '+'; }
            else if (type === 'pay_worker') { colorClass = 'bg-gray-500'; amountClass = 'text-gray-800'; prefix = '-'; }

            return (
                <div className="flex justify-between items-center py-3 border-b border-gray-100 last:border-0 animate-fade-in">
                    <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold text-sm shadow-sm flex-shrink-0 ${colorClass}`}>
                            {day}
                        </div>
                        <div>
                            <div className="font-bold text-gray-800 text-base leading-tight">{label}</div>
                            {item.days && <div className="text-xs text-gray-400 mt-0.5 font-bold">{item.days} å·¥</div>}
                        </div>
                    </div>
                    <div className="flex items-center gap-3">
                        <span className={`font-bold text-base ${amountClass}`}>
                            {prefix}{fmt(item.amount)}
                        </span>
                        <button onClick={() => onDelete(item.id)} className="w-8 h-8 flex items-center justify-center bg-gray-50 rounded-full text-gray-300 hover:text-red-500 transition-colors">
                            <i className="fa-solid fa-trash-can text-xs"></i>
                        </button>
                    </div>
                </div>
            );
        };

        const SimpleInput = ({ title, onAdd, btnColor, inputColor = "text-black" }) => {
            const [vals, setVals] = useState({ date: getLocalISODate(), note: '', amount: '' });
            const handleSubmit = () => {
                if (!vals.amount) return;
                onAdd(vals);
                setVals({ date: vals.date, note: '', amount: '' });
            };
            return (
                <div className="ios-card">
                    <div className="ios-header"><span className="ios-header-title">{title}</span></div>
                    <div className="p-4 flex flex-col gap-3">
                        <div className="flex gap-2">
                            <input type="date" value={vals.date} onChange={e => setVals({...vals, date: e.target.value})} className="input-field flex-1" />
                            <input type="text" value={vals.note} onChange={e => setVals({...vals, note: e.target.value})} className="input-field flex-[1.5]" placeholder="å‚™è¨»" />
                        </div>
                        <div className="flex gap-2">
                            <input type="number" value={vals.amount} onChange={e => setVals({...vals, amount: e.target.value})} className={`input-field flex-[2] font-bold ${inputColor}`} placeholder="$ é‡‘é¡" />
                            <button onClick={handleSubmit} className={`flex-1 rounded-lg text-white font-bold text-sm ${btnColor}`}>
                                <i className="fa-solid fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const ProjectPaymentForm = ({ title, onAdd }) => {
             const [vals, setVals] = useState({ date: getLocalISODate(), name: '', days: '', amount: '' });
             const handleDaysChange = (val) => {
                 const days = val;
                 setVals(prev => ({ ...prev, days: days, amount: days ? days * 3000 : '' }));
             };
             const handleSubmit = () => {
                 if(!vals.name || !vals.amount) return;
                 onAdd(vals);
                 setVals({ date: vals.date, name: '', days: '', amount: '' });
             };
             return (
                 <div className="ios-card">
                     <div className="ios-header"><span className="ios-header-title">{title}</span></div>
                     <div className="p-4 space-y-3">
                         <div className="flex gap-2">
                             <input type="date" value={vals.date} onChange={e => setVals({...vals, date: e.target.value})} className="input-field flex-1" />
                             <input type="text" value={vals.name} onChange={e => setVals({...vals, name: e.target.value})} className="input-field flex-1" placeholder="é ˜æ¬¾äºº" />
                         </div>
                         <div className="flex gap-2">
                             <div className="flex-1 relative">
                                 <input type="number" value={vals.days} onChange={e => handleDaysChange(e.target.value)} className="input-field text-center font-bold" placeholder="å·¥æ•¸" />
                                 <span className="absolute right-3 top-3 text-xs text-gray-400 pointer-events-none">å·¥</span>
                             </div>
                             <input type="number" value={vals.amount} onChange={e => setVals({...vals, amount: e.target.value})} className="input-field flex-[1.5] font-bold" placeholder="$" />
                         </div>
                         <button onClick={handleSubmit} className="w-full py-3 rounded-lg text-white font-bold text-sm bg-morandi-main">ç™¼æ”¾è–ªè³‡</button>
                     </div>
                 </div>
             );
        };

        const ProgressBar = ({ current, target }) => {
            const pct = target > 0 ? Math.min((current / target) * 100, 100) : 0;
            const isDone = current >= target && target > 0;
            return (
                <div className="bg-white rounded-xl p-4 shadow-sm mt-4">
                    <div className="flex justify-between items-end mb-2">
                        <span className="text-xs font-bold text-gray-400 uppercase tracking-wide">
                            {isDone ? 'ç›®æ¨™é”æˆ ğŸ‰' : 'æœ¬æœˆç›®æ¨™é€²åº¦'}
                        </span>
                        <span className={`text-xs font-bold ${isDone ? 'text-morandi-gold' : 'text-morandi-main'}`}>
                            {Math.round(pct)}%
                        </span>
                    </div>
                    <div className="h-3 w-full bg-gray-100 rounded-full overflow-hidden">
                        <div 
                            className={`h-full transition-all duration-1000 ease-out progress-fill ${isDone ? 'bg-morandi-gold' : 'bg-morandi-main'}`} 
                            style={{ width: `${pct}%` }}
                        ></div>
                    </div>
                    <div className="flex justify-between mt-1 text-[10px] text-gray-400">
                        <span>$0</span>
                        <span>${fmt(target)}</span>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('personal'); 
            const [currentDate, setCurrentDate] = useState(new Date());
            
            // Try to read old data keys first, if not found, use new keys.
            // But to simplify for this user, we will stick to v9 keys for data continuity if they used previous step.
            // If they are new, it defaults to empty.
            // Note: I will use 'ji_transactions_v9' as key to maintain data from previous step.
            const [target, setTarget] = useLocalStorage('ji_target_v9', 100000); 
            const [transactions, setTransactions] = useLocalStorage('ji_transactions_v9', []);

            const yearMonth = useMemo(() => {
                const y = currentDate.getFullYear();
                const m = String(currentDate.getMonth() + 1).padStart(2, '0');
                return `${y}-${m}`;
            }, [currentDate]);
            const displayMonth = `${currentDate.getFullYear()}å¹´ ${currentDate.getMonth() + 1}æœˆ`;
            const prevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
            const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));

            const monthlyData = useMemo(() => {
                return transactions
                    .filter(t => t.date.startsWith(yearMonth))
                    .sort((a, b) => new Date(b.date) - new Date(a.date) || b.id - a.id);
            }, [transactions, yearMonth]);

            const incomeList = monthlyData.filter(t => t.type === 'income');
            const expenseList = monthlyData.filter(t => t.type === 'expense');
            const workLogList = monthlyData.filter(t => t.type === 'work_log');
            const workWithdrawList = monthlyData.filter(t => t.type === 'work_withdraw');
            const dadList = monthlyData.filter(t => t.type === 'dad');
            const payWorkerList = monthlyData.filter(t => t.type === 'pay_worker');

            const totalIncome = incomeList.reduce((sum, t) => sum + Number(t.amount), 0);
            const totalExpense = expenseList.reduce((sum, t) => sum + Number(t.amount), 0);
            const monthlySavings = totalIncome - totalExpense;

            const totalWorkDays = workLogList.reduce((sum, t) => sum + Number(t.days || 0), 0);
            const totalWorkEarnings = workLogList.reduce((sum, t) => sum + Number(t.amount), 0);
            const totalWithdrawAmount = workWithdrawList.reduce((sum, t) => sum + Number(t.amount), 0);
            const unpaidAmount = totalWorkEarnings - totalWithdrawAmount;

            const totalDad = dadList.reduce((sum, t) => sum + Number(t.amount), 0);
            const totalPay = payWorkerList.reduce((sum, t) => sum + Number(t.amount), 0);
            const projectBalance = totalDad - totalPay;

            const addTrans = (type, data) => {
                const newT = { id: Date.now(), type, ...data, amount: Number(data.amount) };
                if (!newT.date.startsWith(yearMonth)) alert(`ç´€éŒ„å·²æ–°å¢è‡³ ${newT.date}ï¼Œè«‹åˆ‡æ›æœˆä»½æŸ¥çœ‹`);
                setTransactions(prev => [newT, ...prev]);
            };
            const removeTrans = (id) => {
                if (confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) setTransactions(prev => prev.filter(t => t.id !== id));
            };

            const canvasRef = useRef(null);
            const chartRef = useRef(null);
            useEffect(() => {
                if (activeTab === 'personal' && canvasRef.current) {
                    if (chartRef.current) chartRef.current.destroy();
                    const ctx = canvasRef.current.getContext('2d');
                    chartRef.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['æ”¶å…¥', 'æ”¯å‡º', 'çµé¤˜'],
                            datasets: [{
                                data: [totalIncome, totalExpense, monthlySavings],
                                backgroundColor: ['#A7D7C5', '#F4ACB7', '#778DA9'],
                                borderRadius: 6, barThickness: 40
                            }]
                        },
                        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } } }
                    });
                }
            }, [activeTab, totalIncome, totalExpense, monthlySavings]);

            return (
                <div className="max-w-md mx-auto min-h-screen">
                    <div className="sticky top-0 z-50 bg-[#F2F2F7]/95 backdrop-blur-md px-4 py-3 border-b border-gray-200">
                        <div className="flex justify-between items-center bg-white rounded-xl p-1 shadow-sm">
                            <button onClick={prevMonth} className="w-10 h-8 text-gray-400 hover:text-ios-blue active:scale-90 transition-transform"><i className="fa-solid fa-chevron-left"></i></button>
                            <div className="font-rounded font-bold text-lg text-morandi-accent">{displayMonth}</div>
                            <button onClick={nextMonth} className="w-10 h-8 text-gray-400 hover:text-ios-blue active:scale-90 transition-transform"><i className="fa-solid fa-chevron-right"></i></button>
                        </div>
                    </div>

                    <div className="px-4 mt-4">
                        <div className="segment-control">
                            <div onClick={() => setActiveTab('personal')} className={`segment-btn ${activeTab === 'personal' ? 'active-tab' : 'inactive-tab'}`}>é¤Šæˆæ—¥è¨˜</div>
                            <div onClick={() => setActiveTab('hours')} className={`segment-btn ${activeTab === 'hours' ? 'active-tab' : 'inactive-tab'}`}>å·¥æ™‚ç´€éŒ„</div>
                            <div onClick={() => setActiveTab('work')} className={`segment-btn ${activeTab === 'work' ? 'active-tab' : 'inactive-tab'}`}>å·¥åœ°è¨˜å¸³</div>
                        </div>

                        {activeTab === 'personal' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-gradient-to-br from-[#778DA9] to-[#415A77] rounded-2xl p-6 text-white shadow-ios relative overflow-hidden">
                                    <div className="flex justify-between items-start mb-2 relative z-10">
                                        <span className="text-xs font-bold opacity-80 uppercase tracking-widest">æœ¬æœˆçµé¤˜</span>
                                        <div className="flex items-center gap-2 bg-white/10 px-2 py-1 rounded-lg backdrop-blur-sm">
                                            <span className="text-xs opacity-70">ç›®æ¨™</span>
                                            <input type="number" value={target} onChange={(e) => setTarget(e.target.value)} className="w-16 bg-transparent text-right text-xs font-bold outline-none text-white" />
                                        </div>
                                    </div>
                                    <div className={`text-4xl font-rounded font-bold mb-4 tracking-tight relative z-10 ${monthlySavings < 0 ? 'text-red-200' : ''}`}>${fmt(monthlySavings)}</div>
                                </div>
                                
                                {/* æ–°å¢ï¼šç›®æ¨™é€²åº¦æ¢ */}
                                <ProgressBar current={monthlySavings} target={target} />

                                <SimpleInput title={`è–ªè³‡æ”¶å…¥ ($${fmt(totalIncome)})`} onAdd={(d) => addTrans('income', d)} btnColor="bg-ios-green" inputColor="text-ios-green"/>
                                {incomeList.map(t => <ListItem key={t.id} item={t} onDelete={removeTrans} type="income" />)}

                                <ExpenseForm onAdd={(d) => addTrans('expense', d)} />
                                <div className="bg-white rounded-xl px-4 py-2 mb-4">
                                    <div className="text-xs text-gray-400 font-bold uppercase py-2 border-b border-gray-50 flex justify-between">
                                        <span>æ”¯å‡ºåˆ—è¡¨</span>
                                        <span>ç¸½è¨ˆ: ${fmt(totalExpense)}</span>
                                    </div>
                                    {expenseList.length === 0 && <div className="text-center text-xs text-gray-300 py-4">ç„¡æ”¯å‡º</div>}
                                    {expenseList.map(t => <ListItem key={t.id} item={t} onDelete={removeTrans} type="expense" />)}
                                </div>
                                <div className="bg-white rounded-xl p-4 shadow-sm mb-8 h-64"><canvas ref={canvasRef}></canvas></div>
                            </div>
                        )}

                        {activeTab === 'hours' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-5 text-white shadow-ios">
                                    <div className="flex justify-between items-center mb-4">
                                        <div>
                                            <p className="text-xs font-bold opacity-70 uppercase">é è¨ˆç¸½æ”¶å…¥</p>
                                            <div className="text-2xl font-bold">${fmt(totalWorkEarnings)}</div>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-xs font-bold opacity-70 uppercase">å¯¦éš›å·²é ˜</p>
                                            <div className="text-2xl font-bold text-green-300">${fmt(totalWithdrawAmount)}</div>
                                        </div>
                                    </div>
                                    <div className="pt-3 border-t border-white/20">
                                        <div className="flex justify-between items-center">
                                            <span className="text-xs font-bold uppercase tracking-widest opacity-80">æœªçµé¤˜é¡</span>
                                            <span className="text-xl font-bold text-yellow-300">${fmt(unpaidAmount)}</span>
                                        </div>
                                    </div>
                                </div>

                                <WorkHoursForm onAdd={(d) => addTrans('work_log', d)} />
                                <WorkWithdrawForm onAdd={(d) => addTrans('work_withdraw', d)} />

                                <div className="bg-white rounded-xl px-4 py-2 mb-8">
                                    <div className="text-xs text-gray-400 font-bold uppercase py-2 border-b border-gray-50">æœ¬æœˆå·¥æ™‚ç´€éŒ„è¡¨</div>
                                    {[...workLogList, ...workWithdrawList].sort((a,b) => new Date(b.date) - new Date(a.date)).map(t => <ListItem key={t.id} item={t} onDelete={removeTrans} type={t.type} />)}
                                    {workLogList.length === 0 && workWithdrawList.length === 0 && <div className="text-center text-xs text-gray-300 py-4">ç„¡ç´€éŒ„</div>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'work' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-white rounded-2xl p-6 shadow-ios text-center border border-gray-100">
                                    <p className="text-gray-400 text-xs font-bold uppercase mb-2">å·¥åœ°å¸³æˆ¶é¤˜é¡</p>
                                    <div className={`text-4xl font-rounded font-bold mb-2 ${projectBalance < 0 ? 'text-red-500' : 'text-gray-800'}`}>${fmt(projectBalance)}</div>
                                </div>
                                <SimpleInput title={`è³‡é‡‘å…¥å¸³ ($${fmt(totalDad)})`} onAdd={(d) => addTrans('dad', d)} btnColor="bg-ios-blue" inputColor="text-ios-blue"/>
                                {dadList.map(t => <ListItem key={t.id} item={t} onDelete={removeTrans} type="dad" />)}
                                <ProjectPaymentForm title={`ç™¼è–ªæ°´ ($${fmt(totalPay)})`} onAdd={(d) => addTrans('pay_worker', d)} />
                                <div className="bg-white rounded-xl px-4 py-2 mb-8">
                                    <div className="text-xs text-gray-400 font-bold uppercase py-2 border-b border-gray-50">ç™¼æ”¾ç´€éŒ„</div>
                                    {payWorkerList.length === 0 && <div className="text-center text-xs text-gray-300 py-4">ç„¡ç´€éŒ„</div>}
                                    {payWorkerList.map(t => <ListItem key={t.id} item={t} onDelete={removeTrans} type="pay_worker" />)}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

